配置VLAN
摘要
本节介绍为新创建的子接口封装VLAN-ID号和关闭接口的源地址过滤功能的配置过程。新创建的子接口必须封装VLAN-ID号，否则该子接口不能收发报文。同一VRF的各个子接口必须配置相同的VLAN。
开启ARP源过滤的情况下，当系统收到ARP报文时，会先进行报文内容检测。如果查找不到报文中源地址的路由，则会丢弃报文。关闭ARP源过滤的情况下，不会进行该项报文内容检测，进行正常流程处理。
步骤
1. 在EM客户端，选择菜单配置→命令终端→命令处理，在左侧导航树中展开PCF节点。
2. 选择菜单CommonS_TMSP_0→Rosng配置管理→router配置，进入Rosng配置界面。
3. 执行configure terminal命令，进入全局配置模式。
4. 为子接口封装VLAN-ID号。
1. 执行vlan-configuration命令，进入VLAN(Virtual Local Area Network, 虚拟局域网)配置模式。
2. 执行interface命令，进入到VLAN子接口业务配置模式。可对多个VLAN子接口进行配置。
3. 执行encapsulation-dot1q命令，新创建的子接口封装VLAN-ID号。
4. 执行exit命令，退出VLAN子接口业务配置模式。
5. 执行exit命令，退出VLAN配置模式。
5. 关闭接口和子接口的源地址过滤功能。
1. 执行arp命令，进入ARP配置模式。
2. 执行interface命令，进入ARP接口配置模式。可对多个ARP接口进行配置。
3. 执行source-filtered disable命令，关闭接口和子接口的源地址过滤功能。所有的接口及其子接口都要执行。
4. 执行exit命令，退出ARP接口配置模式。
5. 执行exit命令，退出ARP配置模式。
6. 执行exit命令，退出全局配置模式。
7. 执行write命令，保存配置数据。
举例
在配置数据之前，应当完成相关数据规划，数据规划示例参见表1。
表1 数据规划VRF| 接口| 子接口| VLAN ID
---|---|---|---
SBI| 1/0/1/11/0/2/1| 1/0/1/1.11/0/2/1.1| 2001
SIG| 1/0/1/11/0/2/1| 1/0/1/1.21/0/2/1.2| 2002
LOG| 1/0/1/11/0/2/1| 1/0/1/1.31/0/2/1.3| 2003
SMS| 1/0/1/11/0/2/1| 1/0/1/1.41/0/2/1.4| 2004
EDGE| 1/0/1/11/0/2/1| 1/0/1/1.51/0/2/1.5| 2005
根据规划，进行如下配置。
1. 在EM客户端，选择菜单配置→命令终端→命令处理，在左侧导航树中展开PCF节点。
2. 选择菜单CommonS_TMSP_0→Rosng配置管理→router配置，进入Rosng配置界面。
3. 进入全局配置模式。
ZXROSNG#configure terminal
4. 为子接口封装VLAN-ID号。
1. 进入VLAN(Virtual Local Area Network, 虚拟局域网)配置模式。
ZXROSNG(config)#vlan-configuration
2. 为VRF SBI的子接口封装VLAN ID。
ZXROSNG(config-vlan)#interface xgei-1/0/1/1.1
ZXROSNG(config-vlan-if-xgei-1/0/1/1.1)#encapsulation-dot1q 2001
ZXROSNG(config-vlan-if-xgei-1/0/1/1.1)#exit
ZXROSNG(config-vlan)#interface xgei-1/0/2/1.1
ZXROSNG(config-vlan-if-xgei-1/0/2/1.1)#encapsulation-dot1q 2001
ZXROSNG(config-vlan-if-xgei-1/0/2/1.1)#exit
3. 为VRF SIG的子接口封装VLAN ID。
ZXROSNG(config-vlan)#interface xgei-1/0/1/1.2
ZXROSNG(config-vlan-if-xgei-1/0/1/1.2)#encapsulation-dot1q 2002
ZXROSNG(config-vlan-if-xgei-1/0/1/1.2)#exit
ZXROSNG(config-vlan)#interface xgei-1/0/2/1.2
ZXROSNG(config-vlan-if-xgei-1/0/2/1.2)#encapsulation-dot1q 2002
ZXROSNG(config-vlan-if-xgei-1/0/2/1.2)#exit
4. 为VRF LOG的子接口封装VLAN ID。
ZXROSNG(config-vlan)#interface xgei-1/0/1/1.3
ZXROSNG(config-vlan-if-xgei-1/0/1/1.3)#encapsulation-dot1q 2003
ZXROSNG(config-vlan-if-xgei-1/0/1/1.3)#exit
ZXROSNG(config-vlan)#interface xgei-1/0/2/1.3
ZXROSNG(config-vlan-if-xgei-1/0/2/1.3)#encapsulation-dot1q 2003
ZXROSNG(config-vlan-if-xgei-1/0/2/1.3)#exit
5. 为VRF SMS的子接口封装VLAN ID。
ZXROSNG(config-vlan)#interface xgei-1/0/1/1.4
ZXROSNG(config-vlan-if-xgei-1/0/1/1.4)#encapsulation-dot1q 2004
ZXROSNG(config-vlan-if-xgei-1/0/1/1.4)#exit
ZXROSNG(config-vlan)#interface xgei-1/0/2/1.4
ZXROSNG(config-vlan-if-xgei-1/0/2/1.4)#encapsulation-dot1q 2004
ZXROSNG(config-vlan-if-xgei-1/0/2/1.4)#exit
6. 为VRF EDGE的子接口封装VLAN ID。
ZXROSNG(config-vlan)#interface xgei-1/0/1/1.5
ZXROSNG(config-vlan-if-xgei-1/0/1/1.5)#encapsulation-dot1q 2005
ZXROSNG(config-vlan-if-xgei-1/0/1/1.5)#exit
ZXROSNG(config-vlan)#interface xgei-1/0/2/1.5
ZXROSNG(config-vlan-if-xgei-1/0/2/1.5)#encapsulation-dot1q 2005
ZXROSNG(config-vlan-if-xgei-1/0/2/1.5)#exit
7. 退出VLAN配置模式。
ZXROSNG(config-vlan)#exit
5. 关闭接口和子接口源地址过滤功能。
1. 进入ARP配置模式。
ZXROSNG(config)#arp
2. 关闭接口1/0/1/1以及相关子接口的源地址过滤功能。
ZXROSNG(config-arp)#interface xgei-1/0/1/1
ZXROSNG(config-arp-if-xgei-1/0/1/1)#source-filtered disable
ZXROSNG(config-arp-if-xgei-1/0/1/1)#exit
ZXROSNG(config-arp)#interface xgei-1/0/1/1.1
ZXROSNG(config-arp-if-xgei-1/0/1/1.1)#source-filtered disable
ZXROSNG(config-arp-if-xgei-1/0/1/1.1)#exit
ZXROSNG(config-arp)#interface xgei-1/0/1/1.2
ZXROSNG(config-arp-if-xgei-1/0/1/1.2)#source-filtered disable
ZXROSNG(config-arp-if-xgei-1/0/1/1.2)#exit
ZXROSNG(config-arp)#interface xgei-1/0/1/1.3
ZXROSNG(config-arp-if-xgei-1/0/1/1.3)#source-filtered disable
ZXROSNG(config-arp-if-xgei-1/0/1/1.3)#exit
ZXROSNG(config-arp)#interface xgei-1/0/1/1.4
ZXROSNG(config-arp-if-xgei-1/0/1/1.4)#source-filtered disable
ZXROSNG(config-arp-if-xgei-1/0/1/1.4)#exit
ZXROSNG(config-arp)#interface xgei-1/0/1/1.5
ZXROSNG(config-arp-if-xgei-1/0/1/1.5)#source-filtered disable
ZXROSNG(config-arp-if-xgei-1/0/1/1.5)#exit
3. 关闭接口1/0/2/1以及相关子接口的源地址过滤功能。
ZXROSNG(config-arp)#interface xgei-1/0/2/1
ZXROSNG(config-arp-if-xgei-1/0/2/1)#source-filtered disable
ZXROSNG(config-arp-if-xgei-1/0/2/1)#exit
ZXROSNG(config-arp)#interface xgei-1/0/2/1.1
ZXROSNG(config-arp-if-xgei-1/0/2/1.1)#source-filtered disable
ZXROSNG(config-arp-if-xgei-1/0/2/1.1)#exit
ZXROSNG(config-arp)#interface xgei-1/0/2/1.2
ZXROSNG(config-arp-if-xgei-1/0/2/1.2)#source-filtered disable
ZXROSNG(config-arp-if-xgei-1/0/2/1.2)#exit
ZXROSNG(config-arp)#interface xgei-1/0/2/1.3
ZXROSNG(config-arp-if-xgei-1/0/2/1.3)#source-filtered disable
ZXROSNG(config-arp-if-xgei-1/0/2/1.3)#exit
ZXROSNG(config-arp)#interface xgei-1/0/2/1.4
ZXROSNG(config-arp-if-xgei-1/0/2/1.4)#source-filtered disable
ZXROSNG(config-arp-if-xgei-1/0/2/1.4)#exit
ZXROSNG(config-arp)#interface xgei-1/0/2/1.5
ZXROSNG(config-arp-if-xgei-1/0/2/1.5)#source-filtered disable
ZXROSNG(config-arp-if-xgei-1/0/2/1.5)#exit
4. 退出ARP配置模式。
ZXROSNG(config-arp)#exit
6. 退出全局配置模式。
ZXROSNG(config)#exit
7. 保存配置数据。
ZXROSNG#write
相关任务
配置完成后，可以执行show interface-vlan命令查看VLAN配置的相关信息。
