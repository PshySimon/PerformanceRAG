# ESæœç´¢Pipelineé…ç½®
components:
  es_retriever:
    type: "retriever"
    name: "elasticsearch"
    config:
      index_name: "vector_performance_docs"
      host: "localhost"
      port: 9200
      username: "elastic"
      password: "sPxLec=NGSFmUT_7+74R"
      use_ssl: true
      verify_certs: false
      search_type: "hybrid"
      similarity_threshold: 0.75
      
      # Small2Bigæ£€ç´¢é…ç½®
      enable_small2big: true
      small2big_config:
        small_chunk_size: 128
        medium_chunk_size: 512
        big_chunk_size: 1536
        expansion_strategy: "parent_expansion"
        small_chunk_top_k: 20
        final_top_k: 10
        similarity_threshold_small: 0.6
        score_fusion_method: "max"
        enable_score_normalization: true
        diversity_threshold: 0.8
        max_small_chunks_per_big: 5
      
      # RRFèåˆé…ç½®
      fusion_method: "rrf"
      rrf_k: 60
      text_weight: 1.0
      vector_weight: 1.2
      
      # ğŸ”§ ä¿®æ”¹æœç´¢å­—æ®µé…ç½®ï¼Œæ·»åŠ  content_jieba
      search_fields: {
        "content": 2.0,
        "content_jieba": 2.5,  # ç»™jiebaåˆ†è¯å­—æ®µæ›´é«˜æƒé‡
        "metadata.file_path": 1.2,
        "metadata.title": 1.5   # å¦‚æœæœ‰titleå­—æ®µä¹ŸåŠ ä¸Š
      }
      
      # ğŸ†• æ·»åŠ åˆ†æå™¨é…ç½®
      analyzer_config:
        search_analyzer: "ik_search_analyzer"  # æœç´¢æ—¶ä½¿ç”¨ik_smart
        index_analyzer: "ik_analyzer"          # ç´¢å¼•æ—¶ä½¿ç”¨ik_max_word
      
      # ğŸ†• æ·»åŠ é«˜äº®é…ç½®
      highlight_config:
        require_field_match: false  # å…è®¸è·¨å­—æ®µé«˜äº®
        fragment_size: 150
        number_of_fragments: 3
        pre_tags: ["<mark>"]
        post_tags: ["</mark>"]
        # ä¸ºä¸åŒå­—æ®µè®¾ç½®ä¸åŒçš„é«˜äº®å‚æ•°
        fields:
          content:
            fragment_size: 200
            number_of_fragments: 2
          content_jieba:
            fragment_size: 200
            number_of_fragments: 2
            analyzer: "ik_search_analyzer"  # æ˜ç¡®æŒ‡å®šåˆ†æå™¨
          "metadata.file_path":
            fragment_size: 100
            number_of_fragments: 1
      
      embedding:
        type: "openai"
        model: "models/bge-m3"
        field_name: "content_vector"
        api_key: "123456"
        api_base: "http://workspace.featurize.cn:38819/v1"
        batch_size: 10
        timeout: 30
      debug: true
  
  openai_reranker:
    type: "reranker"
    name: "openai"
    config:
      api_key: "123456"
      base_url: "http://workspace.featurize.cn:62294/v1"
      model: "models/bge-reranker-v2-m3"
      top_k: 10
      debug: true
  
  openai_generator:
    type: "generator"
    name: "llm"

# æµç¨‹å®šä¹‰
flow:
  es_retriever: ["openai_reranker"]
  openai_reranker: ["openai_generator"]
  openai_generator: []

# å…¥å£ç‚¹
entry_points:
  search: "es_retriever"
